package com.example.quakereport;

import android.util.Log;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.util.ArrayList;

public final class QueryUtils {

    private static final String SAMPLE_JSON_RESPONSE = "" +
            "{\"type\":\"FeatureCollection\", " +
            "\"metadata\":{\"generated\":1560439308000, \"url\":\"https://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&starttime=2019-05-11&endtime=2019-06-12&minmag=6&limit=10\", \"title\":\"USGS Earthquakes\", \"status\":200, \"api\":\"1.8.1\", \"limit\":10, \"offset\":1, \"count\":10 }, \"features\":[ " +
            "{ \"type\":\"Feature\", \"properties\":{ \"mag\":6.3, \"place\":\"Izu Islands, Japan region\", \"time\":1559623157501, \"updated\":1560186912387, \"tz\":540, \"url\":\"https://earthquake.usgs.gov/earthquakes/eventpage/us70003v3j\", \"detail\":\"https://earthquake.usgs.gov/fdsnws/event/1/query?eventid=us70003v3j&format=geojson\", \"felt\":4, \"cdi\":3.1, \"mmi\":0, \"alert\":\"green\", \"status\":\"reviewed\", \"tsunami\":0, \"sig\":612, \"net\":\"us\", \"code\":\"70003v3j\", \"ids\":\",us70003v3j,\", \"sources\":\",us,\", \"types\":\",dyfi,geoserve,losspager,moment-tensor,origin,phase-data,shakemap,\", \"nst\":null, \"dmin\":3.219, \"rms\":0.8, \"gap\":21, \"magType\":\"mww\", \"type\":\"earthquake\", \"title\":\"M 6.3 - Izu Islands, Japan region\" }, \"geometry\":{ \"type\":\"Point\", \"coordinates\":[ 139.2932, 29.0623, 430.3 ] }, \"id\":\"us70003v3j\" }, " +
            "{ \"type\":\"Feature\", \"properties\":{ \"mag\":6.1, \"place\":\"42km ESE of Pondaguitan, Philippines\", \"time\":1559297552135, \"updated\":1559384412962, \"tz\":480, \"url\":\"https://earthquake.usgs.gov/earthquakes/eventpage/us70003tl7\", \"detail\":\"https://earthquake.usgs.gov/fdsnws/event/1/query?eventid=us70003tl7&format=geojson\", \"felt\":37, \"cdi\":5.3, \"mmi\":4.386, \"alert\":\"green\", \"status\":\"reviewed\", \"tsunami\":0, \"sig\":592, \"net\":\"us\", \"code\":\"70003tl7\", \"ids\":\",us70003tl7,\", \"sources\":\",us,\", \"types\":\",dyfi,geoserve,ground-failure,losspager,moment-tensor,origin,phase-data,shakemap,\", \"nst\":null, \"dmin\":1.254, \"rms\":1.22, \"gap\":26, \"magType\":\"mww\", \"type\":\"earthquake\", \"title\":\"M 6.1 - 42km ESE of Pondaguitan, Philippines\" }, \"geometry\":{ \"type\":\"Point\", \"coordinates\":[ 126.5518, 6.2643, 90.21 ] }, \"id\":\"us70003tl7\" }," +
            "{ \"type\":\"Feature\", \"properties\":{ \"mag\":6.6, \"place\":\"27km SSE of La Libertad, El Salvador\", \"time\":1559207012403, \"updated\":1559622072577, \"tz\":-360, \"url\":\"https://earthquake.usgs.gov/earthquakes/eventpage/us70003t2n\", \"detail\":\"https://earthquake.usgs.gov/fdsnws/event/1/query?eventid=us70003t2n&format=geojson\", \"felt\":450, \"cdi\":7.2, \"mmi\":6.259, \"alert\":\"yellow\", \"status\":\"reviewed\", \"tsunami\":1, \"sig\":994, \"net\":\"us\", \"code\":\"70003t2n\", \"ids\":\",at00psb7tv,pt19150000,us70003t2n,\", \"sources\":\",at,pt,us,\", \"types\":\",dyfi,geoserve,ground-failure,impact-link,losspager,moment-tensor,origin,phase-data,shakemap,\", \"nst\":null, \"dmin\":1.152, \"rms\":1.28, \"gap\":39, \"magType\":\"mww\", \"type\":\"earthquake\", \"title\":\"M 6.6 - 27km SSE of La Libertad, El Salvador\" }, \"geometry\":{ \"type\":\"Point\", \"coordinates\":[ -89.2719, 13.2428, 65.08 ] }, \"id\":\"us70003t2n\" }, " +
            "{ \"type\":\"Feature\", \"properties\":{ \"mag\":8, \"place\":\"78km SE of Lagunas, Peru\", \"time\":1558856475157, \"updated\":1560266980331, \"tz\":-300, \"url\":\"https://earthquake.usgs.gov/earthquakes/eventpage/us60003sc0\", \"detail\":\"https://earthquake.usgs.gov/fdsnws/event/1/query?eventid=us60003sc0&format=geojson\", \"felt\":1763, \"cdi\":8.9, \"mmi\":7.943, \"alert\":\"orange\", \"status\":\"reviewed\", \"tsunami\":1, \"sig\":1890, \"net\":\"us\", \"code\":\"60003sc0\", \"ids\":\",at00ps3pco,pt19146001,us60003sc0,\", \"sources\":\",at,pt,us,\", \"types\":\",dyfi,finite-fault,general-text,geoserve,ground-failure,impact-link,impact-text,losspager,moment-tensor,origin,phase-data,poster,shakemap,\", \"nst\":null, \"dmin\":3.179, \"rms\":0.87, \"gap\":25, \"magType\":\"mww\", \"type\":\"earthquake\", \"title\":\"M 8.0 - 78km SE of Lagunas, Peru\" }, \"geometry\":{ \"type\":\"Point\", \"coordinates\":[ -75.2638, -5.8074, 122.82 ] }, \"id\":\"us60003sc0\" }, " +
            "{ \"type\":\"Feature\", \"properties\":{ \"mag\":6.1, \"place\":\"55km ENE of Amatignak Island, Alaska\", \"time\":1558601118547, \"updated\":1559790793396, \"tz\":-600, \"url\":\"https://earthquake.usgs.gov/earthquakes/eventpage/us60003r2r\", \"detail\":\"https://earthquake.usgs.gov/fdsnws/event/1/query?eventid=us60003r2r&format=geojson\", \"felt\":4, \"cdi\":8.1, \"mmi\":4.944, \"alert\":\"green\", \"status\":\"reviewed\", \"tsunami\":1, \"sig\":576, \"net\":\"us\", \"code\":\"60003r2r\", \"ids\":\",us60003r2r,at00pry8bj,ak0196kmvs2b,\", \"sources\":\",us,at,ak,\", \"types\":\",dyfi,geoserve,ground-failure,impact-link,losspager,moment-tensor,origin,phase-data,shakemap,\", \"nst\":null, \"dmin\":0.882, \"rms\":1.34, \"gap\":111, \"magType\":\"mww\", \"type\":\"earthquake\", \"title\":\"M 6.1 - 55km ENE of Amatignak Island, Alaska\" }, \"geometry\":{ \"type\":\"Point\", \"coordinates\":[ -178.3306, 51.3631, 27.79 ] }, \"id\":\"us60003r2r\" }, " +
            "{ \"type\":\"Feature\", \"properties\":{ \"mag\":6.3, \"place\":\"164km E of Tadine, New Caledonia\", \"time\":1558277810691, \"updated\":1559076863902, \"tz\":660, \"url\":\"https://earthquake.usgs.gov/earthquakes/eventpage/us70003n96\", \"detail\":\"https://earthquake.usgs.gov/fdsnws/event/1/query?eventid=us70003n96&format=geojson\", \"felt\":1, \"cdi\":2, \"mmi\":3.785, \"alert\":\"green\", \"status\":\"reviewed\", \"tsunami\":1, \"sig\":611, \"net\":\"us\", \"code\":\"70003n96\", \"ids\":\",us70003n96,pt19139002,at00prrauo,\", \"sources\":\",us,pt,at,\", \"types\":\",dyfi,geoserve,ground-failure,impact-link,losspager,moment-tensor,origin,phase-data,shakemap,\", \"nst\":null, \"dmin\":2.125, \"rms\":1.07, \"gap\":75, \"magType\":\"mww\", \"type\":\"earthquake\", \"title\":\"M 6.3 - 164km E of Tadine, New Caledonia\" }, \"geometry\":{ \"type\":\"Point\", \"coordinates\":[ 169.4692, -21.6074, 20 ] }, \"id\":\"us70003n96\" }, " +
            "{ \"type\":\"Feature\", \"properties\":{ \"mag\":6, \"place\":\"176km E of Tadine, New Caledonia\", \"time\":1558276032394, \"updated\":1559072803951, \"tz\":660, \"url\":\"https://earthquake.usgs.gov/earthquakes/eventpage/us70003n8z\", \"detail\":\"https://earthquake.usgs.gov/fdsnws/event/1/query?eventid=us70003n8z&format=geojson\", \"felt\":null, \"cdi\":null, \"mmi\":0, \"alert\":\"green\", \"status\":\"reviewed\", \"tsunami\":0, \"sig\":554, \"net\":\"us\", \"code\":\"70003n8z\", \"ids\":\",us70003n8z,\", \"sources\":\",us,\", \"types\":\",geoserve,losspager,moment-tensor,origin,phase-data,shakemap,\", \"nst\":null, \"dmin\":2.155, \"rms\":1.05, \"gap\":53, \"magType\":\"mww\", \"type\":\"earthquake\", \"title\":\"M 6.0 - 176km E of Tadine, New Caledonia\" }, \"geometry\":{ \"type\":\"Point\", \"coordinates\":[ 169.5741, -21.7384, 19.95 ] }, \"id\":\"us70003n8z\" }, " +
            "{ \"type\":\"Feature\", \"properties\":{ \"mag\":6.3, \"place\":\"199km E of Tadine, New Caledonia\", \"time\":1558229009130, \"updated\":1558454221040, \"tz\":660, \"url\":\"https://earthquake.usgs.gov/earthquakes/eventpage/us70003n4z\", \"detail\":\"https://earthquake.usgs.gov/fdsnws/event/1/query?eventid=us70003n4z&format=geojson\", \"felt\":1, \"cdi\":2.2, \"mmi\":0, \"alert\":\"green\", \"status\":\"reviewed\", \"tsunami\":1, \"sig\":611, \"net\":\"us\", \"code\":\"70003n4z\", \"ids\":\",us70003n4z,pt19139000,at00prq977,\", \"sources\":\",us,pt,at,\", \"types\":\",dyfi,geoserve,ground-failure,impact-link,losspager,moment-tensor,origin,phase-data,shakemap,\", \"nst\":null, \"dmin\":2.378, \"rms\":1.21, \"gap\":18, \"magType\":\"mww\", \"type\":\"earthquake\", \"title\":\"M 6.3 - 199km E of Tadine, New Caledonia\" }, \"geometry\":{ \"type\":\"Point\", \"coordinates\":[ 169.8042, -21.6713, 20 ] }, \"id\":\"us70003n4z\" }, " +
            "{ \"type\":\"Feature\", \"properties\":{ \"mag\":7.5, \"place\":\"45km NE of Kokopo, Papua New Guinea\", \"time\":1557838706074, \"updated\":1558647247736, \"tz\":600, \"url\":\"https://earthquake.usgs.gov/earthquakes/eventpage/us70003kyy\", \"detail\":\"https://earthquake.usgs.gov/fdsnws/event/1/query?eventid=us70003kyy&format=geojson\", \"felt\":54, \"cdi\":6.7, \"mmi\":7.169, \"alert\":\"green\", \"status\":\"reviewed\", \"tsunami\":1, \"sig\":902, \"net\":\"us\", \"code\":\"70003kyy\", \"ids\":\",pt19134000,us70003kyy,\", \"sources\":\",pt,us,\", \"types\":\",dyfi,finite-fault,general-link,general-text,geoserve,ground-failure,impact-link,losspager,moment-tensor,origin,phase-data,poster,shakemap,\", \"nst\":null, \"dmin\":0.419, \"rms\":1.48, \"gap\":24, \"magType\":\"mww\", \"type\":\"earthquake\", \"title\":\"M 7.5 - 45km NE of Kokopo, Papua New Guinea\" }, \"geometry\":{ \"type\":\"Point\", \"coordinates\":[ 152.5694, -4.081, 10 ] }, \"id\":\"us70003kyy\" }, " +
            "{ \"type\":\"Feature\", \"properties\":{ \"mag\":6, \"place\":\"9km N of Canoas, Costa Rica\", \"time\":1557689090395, \"updated\":1560022706176, \"tz\":-300, \"url\":\"https://earthquake.usgs.gov/earthquakes/eventpage/us70003k3p\", \"detail\":\"https://earthquake.usgs.gov/fdsnws/event/1/query?eventid=us70003k3p&format=geojson\", \"felt\":176, \"cdi\":8.6, \"mmi\":6.637, \"alert\":\"yellow\", \"status\":\"reviewed\", \"tsunami\":0, \"sig\":801, \"net\":\"us\", \"code\":\"70003k3p\", \"ids\":\",us70003k3p,\", \"sources\":\",us,\", \"types\":\",dyfi,geoserve,ground-failure,impact-text,losspager,moment-tensor,origin,phase-data,shakemap,\", \"nst\":null, \"dmin\":0.222, \"rms\":1.11, \"gap\":53, \"magType\":\"mww\", \"type\":\"earthquake\", \"title\":\"M 6.0 - 9km N of Canoas, Costa Rica\" }, \"geometry\":{ \"type\":\"Point\", \"coordinates\":[ -82.8326, 8.6227, 19 ] }, \"id\":\"us70003k3p\" } ], " +
            "\"bbox\":[ -178.3306, -21.7384, 10, 169.8042, 51.3631, 430.3 ] }";

    public static ArrayList<EarthquakeData> extractEarthquakes() {
        ArrayList<EarthquakeData> earthquake = new ArrayList<>();

        try {

            JSONObject root = new JSONObject(SAMPLE_JSON_RESPONSE);
            JSONArray features = root.getJSONArray("features");
            for(int i = 0; i < features.length(); i++) {
                JSONObject insideFeatures = features.getJSONObject(i);
                JSONObject properties = insideFeatures.optJSONObject("properties");
                double magnitude = properties.getDouble("mag");
                String place = properties.getString("place");
                long time = properties.getLong("time");
                String url = properties.getString("url");
                earthquake.add(new EarthquakeData(magnitude, place, time, url));
            }

        } catch(JSONException e) {
            e.printStackTrace();
            Log.e("QueryUtils", "Problem parsing the earthquake JSON results", e);
        }
        return earthquake;
    }
}
